<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Birthday Garden</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* --- üé® CHANGE YOUR PICTURES HERE üé® --- */
            
            /* 1. The Sky (Background) */
            --sky-image: url('https://images.unsplash.com/photo-1604093882750-3ed498f3813b?q=80&w=1920&auto=format&fit=crop');
            
            /* 2. The Ground (Bottom half) */
            --ground-image: url('https://images.unsplash.com/photo-1533460004989-bf46a2902e1b?q=80&w=1920&auto=format&fit=crop');
        }

        body, html { margin: 0; padding: 0; overflow: hidden; height: 100%; font-family: 'Nunito', sans-serif; }

        /* --- LAYERS --- */
        #world {
            position: relative; width: 100%; height: 100%; overflow: hidden;
        }

        #sky-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: var(--sky-image);
            background-size: cover; background-position: center bottom;
            z-index: 1;
        }

        #ground-layer {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 45%; /* Ground takes up bottom 45% */
            background-image: var(--ground-image);
            background-size: cover; background-position: center top;
            z-index: 2;
            /* Optional: Add a fuzzy edge so it blends into the sky */
            mask-image: linear-gradient(to bottom, transparent, black 10%);
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 10%);
        }

        /* --- TITLE --- */
        #main-title {
            position: absolute; top: 10%; width: 100%; text-align: center; z-index: 10;
            pointer-events: none;
        }
        h1 {
            font-family: 'Fredoka One', cursive; color: #fff; font-size: 3.5rem; margin: 0;
            text-shadow: 0px 4px 10px rgba(0,0,0,0.3); letter-spacing: 2px;
            animation: float 4s ease-in-out infinite;
        }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-15px); } 100% { transform: translateY(0px); } }

        /* --- UI BUTTONS --- */
        #ui { position: absolute; bottom: 30px; width: 100%; text-align: center; z-index: 50; pointer-events: none; }
        .big-btn { 
            pointer-events: auto; background: #FF6B6B; color: white; 
            font-family: 'Fredoka One', cursive; font-size: 1.2rem;
            padding: 15px 30px; border-radius: 50px; border: none;
            box-shadow: 0 6px 0px #C92A2A, 0 10px 10px rgba(0,0,0,0.2);
            cursor: pointer; transition: transform 0.1s;
        }
        .big-btn:active { transform: translateY(4px); box-shadow: 0 2px 0px #C92A2A; }

        /* --- DRAWING MODAL --- */
        .modal-overlay {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8);
            z-index: 100; align-items: center; justify-content: center;
            backdrop-filter: blur(5px);
        }
        .modal-box {
            background: white; padding: 20px; border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3); text-align: center;
            max-width: 90%; width: 350px; position: relative;
        }

        canvas { border: 2px dashed #ccc; border-radius: 15px; cursor: crosshair; touch-action: none; background: #fff; }

        /* --- CUSTOM COLOR PICKER --- */
        .palette { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin: 15px 0; }
        .swatch {
            width: 30px; height: 30px; border-radius: 50%; cursor: pointer;
            border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }
        .swatch:hover, .swatch.active { transform: scale(1.2); border-color: #333; }

        /* --- BIRTHDAY CARD POPUP --- */
        #card-content { background: #fff9f0; border: 4px solid #FFD700; }
        #card-image { width: 180px; height: 180px; object-fit: contain; margin: 10px auto; display: block; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.1)); }
        #card-wish { font-size: 1.1rem; color: #555; margin: 15px 0; font-style: italic; line-height: 1.5; }
        #card-sender { font-family: 'Fredoka One', cursive; font-size: 1.4rem; color: #FF6B6B; }

        /* --- FLOWERS IN GARDEN --- */
        .flower {
            position: absolute; width: 80px; height: 80px;
            cursor: pointer; transition: transform 0.3s;
            filter: drop-shadow(0px 5px 5px rgba(0,0,0,0.3));
            z-index: 5;
            /* Anchors flower to the bottom center of its position */
            transform-origin: bottom center; 
        }
        .flower img { width: 100%; height: 100%; object-fit: contain; }
        .flower:hover { transform: scale(1.3) translateY(-10px) !important; z-index: 99; }
        
        /* Slight sway animation */
        .flower { animation: sway 3s ease-in-out infinite alternate; }
        @keyframes sway { from { transform: rotate(-3deg); } to { transform: rotate(3deg); } }

        .btn-group { display: flex; gap: 10px; justify-content: center; margin-top: 15px; }
        button.secondary { background: #eee; color: #333; padding: 10px 20px; border-radius: 20px; border: none; font-weight: bold; cursor: pointer; }
        button.primary { background: #4CAF50; color: white; padding: 10px 20px; border-radius: 20px; border: none; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div id="world">
    <div id="sky-layer"></div>
    <div id="ground-layer"></div>
    
    <div id="garden-container"></div>
</div>

<div id="main-title">
    <h1>Happy Birthday!</h1>
</div>

<div id="ui">
    <button class="big-btn" onclick="openDrawer()">‚úèÔ∏è Plant a Wish</button>
</div>

<div id="draw-modal" class="modal-overlay">
    <div class="modal-box">
        <h2 style="font-family:'Fredoka One'; color:#444; margin-top:0;">Draw a Flower!</h2>
        <canvas id="drawingCanvas" width="300" height="300"></canvas>
        <div class="palette" id="colorPalette"></div>
        <div class="btn-group">
            <button class="secondary" onclick="closeDrawer()">Cancel</button>
            <button class="secondary" onclick="clearCanvas()">Clear</button>
            <button class="primary" onclick="saveFlower()">Plant it!</button>
        </div>
    </div>
</div>

<div id="card-modal" class="modal-overlay" onclick="closeCard(event)">
    <div class="modal-box" id="card-content">
        <h2 id="card-sender">Sender Name</h2>
        <img id="card-image" src="" alt="Flower">
        <p id="card-wish">"Wish..."</p>
        <button class="secondary" onclick="document.getElementById('card-modal').style.display='none'">Close Card</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // --- PASTE YOUR FIREBASE CONFIG HERE ---
    const firebaseConfig = {
        apiKey: "AIzaSyCUUyrmqbyUzf5f4-GKidLsW0HsCVNjU0o",
    authDomain: "ccbirthdaygarden.firebaseapp.com",
    projectId: "ccbirthdaygarden",
    storageBucket: "ccbirthdaygarden.firebasestorage.app",
    messagingSenderId: "706882366980",
    appId: "1:706882366980:web:c7a9cc8be0b1ca0d190f51"

    };
    // ---------------------------------------

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    
    const canvas = document.getElementById('drawingCanvas');
    const ctx = canvas.getContext('2d');
    let drawing = false;
    let currentColor = '#FF6B6B'; 

    // 20 Custom Colors
    const colors = [
        '#FF6B6B', '#FF9F43', '#FECA57', '#48DBFB', '#FF9FF3', 
        '#54a0ff', '#5f27cd', '#ff6b6b', '#1dd1a1', '#feca57',
        '#2e86de', '#8395a7', '#222f3e', '#c8d6e5', '#10ac84',
        '#01a3a4', '#f368e0', '#00d2d3', '#341f97', '#273c75'
    ];

    const paletteDiv = document.getElementById('colorPalette');
    colors.forEach(color => {
        const swatch = document.createElement('div');
        swatch.className = 'swatch';
        swatch.style.backgroundColor = color;
        swatch.onclick = () => {
            currentColor = color;
            document.querySelectorAll('.swatch').forEach(s => s.style.border = '2px solid white');
            swatch.style.border = '2px solid #333';
        };
        paletteDiv.appendChild(swatch);
    });

    const getPos = (e) => {
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return { x: clientX - rect.left, y: clientY - rect.top };
    };

    const start = (e) => { drawing = true; draw(e); };
    const end = () => { drawing = false; ctx.beginPath(); };
    const draw = (e) => {
        if (!drawing) return;
        const { x, y } = getPos(e);
        ctx.lineWidth = 5;
        ctx.lineCap = 'round';
        ctx.strokeStyle = currentColor;
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(x, y);
    };

    canvas.addEventListener('mousedown', start);
    canvas.addEventListener('mousemove', draw);
    window.addEventListener('mouseup', end);
    canvas.addEventListener('touchstart', (e) => { e.preventDefault(); start(e); });
    canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); });
    canvas.addEventListener('touchend', end);

    window.openDrawer = () => document.getElementById('draw-modal').style.display = 'flex';
    window.closeDrawer = () => document.getElementById('draw-modal').style.display = 'none';
    window.clearCanvas = () => ctx.clearRect(0, 0, canvas.width, canvas.height);

    window.openCard = (name, wish, image) => {
        document.getElementById('card-sender').innerText = "From: " + name;
        document.getElementById('card-wish').innerText = wish;
        document.getElementById('card-image').src = image;
        document.getElementById('card-modal').style.display = 'flex';
    }
    
    window.closeCard = (e) => {
        if(e.target.id === 'card-modal') {
            document.getElementById('card-modal').style.display = 'none';
        }
    }

    window.saveFlower = async () => {
        const name = prompt("Your Name:");
        if (!name) return;
        const wish = prompt("Write your birthday wish:");
        if (!wish) return;

        const drawingData = canvas.toDataURL("image/png");
        
        try {
            await addDoc(collection(db, "wishes"), {
                name, wish, image: drawingData,
                // PLANTING LOGIC:
                // x = 5% to 90% (horizontal)
                // y = 60% to 90% (vertical) - This ensures it stays on the "Ground" layer (bottom 45%)
                x: Math.random() * 85 + 5, 
                y: Math.random() * 30 + 60,
                timestamp: Date.now()
            });
            closeDrawer();
            clearCanvas();
        } catch (error) {
            console.error("Error", error);
            alert("Error planting flower. Check internet?");
        }
    };

    const q = query(collection(db, "wishes"), orderBy("timestamp", "asc"));
    onSnapshot(q, (snapshot) => {
        const container = document.getElementById('garden-container');
        container.innerHTML = ''; 
        
        snapshot.forEach((doc) => {
            const data = doc.data();
            const div = document.createElement('div');
            div.className = 'flower';
            div.style.left = data.x + '%';
            div.style.top = data.y + '%';
            
            const rot = (Math.random() * 20) - 10; 
            div.style.transform = `rotate(${rot}deg)`;
            
            const img = document.createElement('img');
            img.src = data.image;
            div.appendChild(img);
            div.onclick = () => openCard(data.name, data.wish, data.image);
            container.appendChild(div);
        });
    });
</script>
</body>
</html>